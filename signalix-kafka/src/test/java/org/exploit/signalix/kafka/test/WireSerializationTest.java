package org.exploit.signalix.kafka.test;

import com.fasterxml.jackson.core.JsonProcessingException;
import org.exploit.signalix.marker.Event;
import org.exploit.signalix.utils.EventObjectMapper;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.util.List;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class WireSerializationTest {
    private final EventObjectMapper objectMapper = new EventObjectMapper();

    @BeforeEach
    public void init() {
        objectMapper.registerEvents(() -> List.of(SampleEvent.class));
        objectMapper.init();
    }

    @Test
    public void testSerialize() throws JsonProcessingException {
        var expected = "{\"_name\":\"SampleEvent\",\"foo\":\"Hello world\"}";
        var result = objectMapper.writeValueAsString(new SampleEvent("Hello world"));

        assertEquals(expected, result);
    }

    @Test
    public void testDeserialize() throws JsonProcessingException {
        var serialized = "{\"_name\":\"SampleEvent\",\"foo\":\"Hello world\"}";
        var event = objectMapper.readValue(serialized, Event.class);

        assertEquals(event.getClass(), SampleEvent.class);
    }
}
