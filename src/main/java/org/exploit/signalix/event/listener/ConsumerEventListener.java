package org.exploit.signalix.event.listener;

import org.exploit.signalix.event.EventObject;
import org.exploit.signalix.handler.ConsumerHandler;
import org.exploit.signalix.handler.Handler;
import org.exploit.signalix.marker.Event;
import org.exploit.signalix.utils.EventConsumer;

import java.util.Collections;
import java.util.List;

public class ConsumerEventListener<E extends Event> implements EventListener {
    private final EventConsumer<E> eventConsumer;
    private final Class<E> clazz;

    public ConsumerEventListener(EventConsumer<E> eventConsumer, Class<E> clazz) {
        this.eventConsumer = eventConsumer;
        this.clazz = clazz;
    }

    @Override
    @SuppressWarnings("unchecked")
    public <T extends Event> List<Handler<T>> getEventHandlers(EventObject<T> eventObject) {
        var event = eventObject.getEvent();

        if (!clazz.isInstance(event)) {
            return Collections.emptyList();
        }

        var handler = (ConsumerHandler<T>) new ConsumerHandler<>(eventConsumer);
        return Collections.singletonList(handler);
    }

    @Override
    public List<Class<? extends Event>> getHandledEvents() {
        return List.of(clazz);
    }

    @Override
    public String getName() {
        return clazz.getName();
    }
}
